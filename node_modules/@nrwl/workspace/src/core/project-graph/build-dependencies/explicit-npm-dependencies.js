"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const typescript_import_locator_1 = require("./typescript-import-locator");
function buildExplicitNpmDependencies(ctx, nodes, addDependency, fileRead) {
    const importLocator = new typescript_import_locator_1.TypeScriptImportLocator(fileRead);
    const npmProjects = Object.values(nodes).filter((node) => node.type === 'npm');
    Object.keys(ctx.fileMap).forEach((source) => {
        Object.values(ctx.fileMap[source]).forEach((f) => {
            importLocator.fromFile(f.file, (importExpr, filePath, type) => {
                const pkg = npmProjects.find((pkg) => isNpmPackageImport(pkg.data.packageName, importExpr));
                if (pkg) {
                    const target = nodes[pkg.name];
                    if (source && target) {
                        addDependency(type, source, target.name);
                    }
                }
            });
        });
    });
}
exports.buildExplicitNpmDependencies = buildExplicitNpmDependencies;
function isNpmPackageImport(p, e) {
    const toMatch = e
        .split(/[\/]/)
        .slice(0, p.startsWith('@') ? 2 : 1)
        .join('/');
    return toMatch === p;
}
//# sourceMappingURL=explicit-npm-dependencies.js.map